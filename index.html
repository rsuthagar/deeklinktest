<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title></title>
	<meta property='og:image:width' content='640' />
	<meta property='og:image:height' content='640' />
	<meta name='twitter:card' content='summary_large_image' />
	<meta name='twitter:site'
		content='https://links-astrostgeks.vsscloud-astro-stg.tv.s3.ap-southeast-1.amazonaws.com/content/36ed2348-26e6-5fd7-a296-230bb038d017~CATC0000000001014675~vod' />
	<meta property='og:url'
		content='https://links-astrostgeks.vsscloud-astro-stg.tv.s3.ap-southeast-1.amazonaws.com/content/36ed2348-26e6-5fd7-a296-230bb038d017~CATC0000000001014675~vod' />

    <meta property='al:android:package' content='com.astro.astro' />
    <meta property='al:android:url' content='https://links-astrostgeks.vsscloud-astro-stg.tv/content/36ed2348-26e6-5fd7-a296-230bb038d017~CATC0000000001014675~vod?contentType=content&utm_source=clevertap&utm_medium=post&utm_campaign=Astro&target=actionMenu&socialTitle=My+Chemical+Romance_Cancer&socialDescription=Short+Synopsis+-+English&socialImageLink=http%3A%2F%2Fstaging-vod-poster.astro.com.my%2Fposter%2FIVP%28STB_OTT_STV%29_Idiot_IVP_LAND_917x516_F7B93_20241129_105743.jpg&contentId=36ed2348-26e6-5fd7-a296-230bb038d017%7ECATC0000000001014675%7Evod' />
    <meta property='al:ios:url' content='https://links-astrostgeks.vsscloud-astro-stg.tv/content/36ed2348-26e6-5fd7-a296-230bb038d017~CATC0000000001014675~vod?contentType=content&utm_source=clevertap&utm_medium=post&utm_campaign=Astro&target=actionMenu&socialTitle=My+Chemical+Romance_Cancer&socialDescription=Short+Synopsis+-+English&socialImageLink=http%3A%2F%2Fstaging-vod-poster.astro.com.my%2Fposter%2FIVP%28STB_OTT_STV%29_Idiot_IVP_LAND_917x516_F7B93_20241129_105743.jpg&contentId=36ed2348-26e6-5fd7-a296-230bb038d017%7ECATC0000000001014675%7Evod' />
    <meta property='al:web:should_fallback' content='true' />
    <meta property='al:web:url' content='https://web.astro-stg.com/campaign_management?contentType=content&utm_source=clevertap&utm_medium=post&utm_campaign=Astro&target=actionMenu&socialTitle=My+Chemical+Romance_Cancer&socialDescription=Short+Synopsis+-+English&socialImageLink=http%3A%2F%2Fstaging-vod-poster.astro.com.my%2Fposter%2FIVP%28STB_OTT_STV%29_Idiot_IVP_LAND_917x516_F7B93_20241129_105743.jpg&contentId=36ed2348-26e6-5fd7-a296-230bb038d017%7ECATC0000000001014675%7Evod' />

	<style>
		body {
			position: relative;
			height: 100vh;
		}

		.text-container {
			position: absolute;
			top: 40%;
			left: 50%;
			transform: translate(-50%, -50%);
			text-align: center;
		}

		.text {
			font-weight: 600;
			font-size: 20px;
			margin-bottom: 50px;
		}

		button {
			position: relative;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			padding: 10px 24px;
			background-color: white;
			border: 1px solid #d1d1d1;
			border-radius: 3px;
			color: #007aff;
			font-weight: 600;
			font-size: 16px;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.40);
			cursor: pointer;
			outline: none;
			transition: background-color 0.2s ease;
		}
	</style>
</head>
<body>
<script type="module">
    (function() {
        // Device detection functions
        function isAndroid() {
            return /Android/i.test(navigator.userAgent);
        }

        function isIOS() {
            return /iPhone|iPad|iPod/i.test(navigator.userAgent) ||
                // iPadOS 13+ pretends to be Mac, but has touch support
                (navigator.userAgent.includes('Macintosh') && 'ontouchend' in document);
        }

        function isBrowser() {
            return (typeof window !== "undefined" && typeof document !== "undefined");
        }

        function openAppOrStore({appOpenCustomSchema, storeUrl}) {
            let openedApp = false;
            const onVis = () => {
                if (document.visibilityState === 'hidden') openedApp = true;
            };

            const onPageHide = () => {
                openedApp = true;
            };

            document.addEventListener('visibilitychange', onVis, { once: true });
            window.addEventListener('pagehide', onPageHide, { once: true });

            //open the app with a custom schema. Note: It is required only on Facebook and Instafram apps which uses embedded webview.
            try{
                window.location = appOpenCustomSchema;
            }
            catch(error){
                console.error('Error while redirecting to app custom schema:', error);
            };

            window.setTimeout(function(){
                document.removeEventListener('visibilitychange', onVis);
                window.removeEventListener('pagehide', onPageHide);

                //link is already opened in the app or it is a facebook WV. No need to redirect to App Store.
                if (openedApp) { 
                    return;
                }

                window.location = storeUrl;
            },2000);
        }

        window.setTimeout(function () {
            // Redirect logic
            if (isAndroid()) {
                // ssr - ANDROID_PACKAGE_NAME, APP_CUSTOM_SCHEMA and FULL_URL  need to be configured as pillar varaibles of deeplink service.

                const androidPackageName = 'com.astro.astro'; // <-- Replace with your Android app's package name
				const appCustomSchema = 'pastrostagingdeeplink';
                const referrer = `https://links-astrostgeks.vsscloud-astro-stg.tv/content/36ed2348-26e6-5fd7-a296-230bb038d017~CATC0000000001014675~vod?contentType=content&utm_source=clevertap&utm_medium=post&utm_campaign=Astro&target=actionMenu&socialTitle=My+Chemical+Romance_Cancer&socialDescription=Short+Synopsis+-+English&socialImageLink=http%3A%2F%2Fstaging-vod-poster.astro.com.my%2Fposter%2FIVP%28STB_OTT_STV%29_Idiot_IVP_LAND_917x516_F7B93_20241129_105743.jpg&contentId=36ed2348-26e6-5fd7-a296-230bb038d017%7ECATC0000000001014675%7Evod` // <-- full url
                const playStoreUrl = `https://play.google.com/store/apps/details?id=${androidPackageName}&referrer=${encodeURIComponent(referrer)}`;

                const userAgent = navigator.userAgent || navigator.vendor || window.opera;
				const playstoreAutoOpenBlockCondition = ( (userAgent.indexOf("FBAV") > -1 || userAgent.indexOf("FB_IAB") > -1) || 
                                                            (userAgent.indexOf("Instagram") > -1 && userAgent.indexOf("wv") > -1) || 
                                                            false ); // default value for BLOCK_AUTO_OPEN_PLAY_STORE_CONDITION is (userAgent.indexOf("FBAV") > -1 || userAgent.indexOf("FB_IAB") > -1)

                const divElement = document.createElement('div');
                divElement.classList.add('text-container');
                const reasonText = document.createElement('p');
                reasonText.classList.add('text');
                reasonText.textContent = 'Open app in Play Store?';
                divElement.appendChild(reasonText);
                document.body.appendChild(divElement);

                const agreeButton = document.createElement('button');
                agreeButton.textContent = 'OPEN';
                agreeButton.onclick = function() {
                    window.location = playStoreUrl;
                }
                document.body.appendChild(agreeButton);


                // try to open the app using the custom schema only for Facebook and Insta as their embedded webview blocks OS from automatically opening the OTT app if installed.
                // For other browsers, directly redirect to Play Store as OS would have launched the OTT app if it is already installed. 
                if( (userAgent.indexOf("FBAV") > -1 || userAgent.indexOf("FB_IAB") > -1) || 
                    (userAgent.indexOf("Instagram") > -1 && userAgent.indexOf("wv") > -1))
                {
                    window.location = `${appCustomSchema}://${encodeURIComponent(referrer)}`;

//                     openAppOrStore({
//                         appOpenCustomSchema: `${appCustomSchema}://${encodeURIComponent(referrer)}`,
// // secured way of launching custom schema                       appOpenCustomSchema: `intent://#Intent;scheme=${appCustomSchema};package=${androidPackageName};S.extras=${encodeURIComponent(referrer)};end`,
//                         storeUrl: playStoreUrl,
//                     });
                } else {
                    window.location = playStoreUrl;
                }
            } else if (isIOS()) {
                // ssr - IOS_APP_STORE_ID, APP_CUSTOM_SCHEMA and FULL_URL need to be configured as pillar varaibles of deeplink service.
                const iosAppId = '521993797'; // <-- Replace with your iOS app's App Store ID
				const appCustomSchema = 'pastrostagingdeeplink';
                const appStoreUrl = `itms-apps://itunes.apple.com/app/id${iosAppId}`;
                const referrer = `https://links-astrostgeks.vsscloud-astro-stg.tv/content/36ed2348-26e6-5fd7-a296-230bb038d017~CATC0000000001014675~vod?contentType=content&utm_source=clevertap&utm_medium=post&utm_campaign=Astro&target=actionMenu&socialTitle=My+Chemical+Romance_Cancer&socialDescription=Short+Synopsis+-+English&socialImageLink=http%3A%2F%2Fstaging-vod-poster.astro.com.my%2Fposter%2FIVP%28STB_OTT_STV%29_Idiot_IVP_LAND_917x516_F7B93_20241129_105743.jpg&contentId=36ed2348-26e6-5fd7-a296-230bb038d017%7ECATC0000000001014675%7Evod`; // `${referrer}` // <-- full url
                const userAgent = navigator.userAgent || navigator.vendor || window.opera;

                const divElement = document.createElement('div');
                divElement.classList.add('text-container');
                const reasonText = document.createElement('p');
                reasonText.classList.add('text');
                reasonText.textContent = 'Open link in app?';
                divElement.appendChild(reasonText);
                document.body.appendChild(divElement);

                const agreeButton = document.createElement('button');
                agreeButton.textContent = 'OPEN';
                agreeButton.onclick = function() {
				    // Write to clipboard and redirect to app or the app store(NOTE: writting to clipboard fails in the timer method, within openAppOrStore method).
                    navigator.clipboard.writeText(`referrer=${encodeURIComponent(referrer)}`)
                        .then(() => {
                            console.log(`Written to device clipboard - referrer=${encodeURIComponent(referrer)}`);
                        })
                        .catch(err => {
                            console.error('Failed to write to clipboard:', err);
                        });

                    openAppOrStore({
                        appOpenCustomSchema: `${appCustomSchema}://${encodeURIComponent(referrer)}`,
                        storeUrl: appStoreUrl,
                    });
                };
                document.body.appendChild(agreeButton);
            } else if (isBrowser()) {
                // For desktop
                const desktopFallback = `https://web.astro-stg.com/campaign_management?contentType=content&utm_source=clevertap&utm_medium=post&utm_campaign=Astro&target=actionMenu&socialTitle=My+Chemical+Romance_Cancer&socialDescription=Short+Synopsis+-+English&socialImageLink=http%3A%2F%2Fstaging-vod-poster.astro.com.my%2Fposter%2FIVP%28STB_OTT_STV%29_Idiot_IVP_LAND_917x516_F7B93_20241129_105743.jpg&contentId=36ed2348-26e6-5fd7-a296-230bb038d017%7ECATC0000000001014675%7Evod`; // <-- Replace with Web UI host and query params from the full URL
                window.location = desktopFallback;
            } else {
                document.body.innerHTML = '<p>This link is intended for Android or iOS device or Chrome, Firefox and Safari web browsers. Please open it on a compatible device.</p>';
            }
        }, 1000);
    })();

</script>
</body>
</html>
